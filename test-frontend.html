<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Frontend Debug Test</title>
</head>
<body>
    <h1>Frontend API Debug</h1>
    <div id="debug-info"></div>
    <input id="nickname-test" type="text" placeholder="ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å" value="TestUser">
    <button onclick="testJoinAPI()">å‚åŠ ãƒ†ã‚¹ãƒˆ</button>
    
    <script>
        // API URLè¨­å®šã‚’ãƒ†ã‚¹ãƒˆ
        const apiUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api/chat'
            : window.location.origin + '/api/chat';
            
        document.getElementById('debug-info').innerHTML = `
            <p><strong>ç¾åœ¨ã®API URL:</strong> ${apiUrl}</p>
            <p><strong>hostname:</strong> ${window.location.hostname}</p>
            <p><strong>origin:</strong> ${window.location.origin}</p>
        `;
        
        async function testJoinAPI() {
            const nickname = document.getElementById('nickname-test').value;
            const debugDiv = document.getElementById('debug-info');
            
            try {
                debugDiv.innerHTML += '<p>ğŸ“¡ APIå‘¼ã³å‡ºã—ä¸­...</p>';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'join', user: nickname })
                });
                
                debugDiv.innerHTML += `<p><strong>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ Status:</strong> ${response.status}</p>`;
                
                const data = await response.json();
                debugDiv.innerHTML += `<p><strong>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ Data:</strong> <pre>${JSON.stringify(data, null, 2)}</pre></p>`;
                
                if (data.success) {
                    debugDiv.innerHTML += '<p>âœ… å‚åŠ æˆåŠŸï¼</p>';
                } else {
                    debugDiv.innerHTML += '<p>âŒ å‚åŠ å¤±æ•—</p>';
                }
                
            } catch (error) {
                debugDiv.innerHTML += `<p><strong>ã‚¨ãƒ©ãƒ¼:</strong> ${error.message}</p>`;
                console.error('API Test Error:', error);
            }
        }
    </script>
</body>
</html>